<html>

<head>    
    <link rel="stylesheet" href="main.css">
    <script type="text/javascript" src="script/jquery-3.3.1.js"></script>
    <link rel="stylesheet" href="script/jquery.dataTables.min.css" />
    <script type="text/javascript" src="script/jquery.dataTables.min.js"></script>
    <script src="script/bus-route.js"></script>
    <style>
        .dataTables_wrapper .dataTables_filter{
          float: left;
        }

        .dataTables_wrapper .dataTables_length {
          float: right;
        }
    </style>
    <script>

        function getRouteList() {
            const tableId = '#routeListTable';

            //Destroy old data
            $(tableId + " > tbody").html("");


            $.getJSON("https://data.etabus.gov.hk/v1/transport/kmb/route/",
                function (data) {
                    const jsonData = data;

                    const records = jsonData.data;
                    if (records.length > 0) {
                        var html = '<thead>';
                        html += '<tr>';
                        html += '<th>路線</th>';
                        html += '<th>起點</th>';
                        html += '<th>終點</th>';
                        html += '</tr>';
                        html += '</thead>';

                        html += '<tbody>';
                        $.each(records, function (index, record) {
                            const route = record.route;
                            const orig = record.orig_tc;
                            const dest = record.dest_tc;
                            const bound = record.bound;
                            const serviceType = record.service_type;

                            html += `<tr id="${route}_${bound}_${serviceType}">`;
                            html += '<td>' + record.route + '</td>';
                            html += '<td>' + record.orig_tc + '</td>';
                            html += '<td>' + record.dest_tc + '</td>';
                            html += '</tr>';
                        });
                        html += '</tbody>';


                        $(tableId).html(html);

                        initDataTable(tableId);
                   }
             });
        }




        function initDataTable(id) {
            if ($.fn.DataTable.isDataTable(id))
                $(id).DataTable().destroy();

            $(id).DataTable({
                "order": [],
                paging: true,
                "info": true,
                "columnDefs": [
                    { "className": "dt-center", "targets": "_all" }
                ]
            });
        }

        $(document).ready(function () {
            getRouteList();
            $('#loadingDiv').hide();
        });


        $(document).ajaxStart(function () {
            $('#loadingDiv').show();
        });

        $(document).ajaxComplete(function () {
            $('#loadingDiv').hide();
        });


    </script>
</head>

<body>
    <div id="loadingDiv">
        Loading...
    </div>
    <div>
        <a id="resultGo" class="anchor"></a>
        <br />
        <table id="routeListTable" class="dataTable display"></table>
    </div>

    <object type="text/html" data="footer.html"></object>
</body>

</html>
